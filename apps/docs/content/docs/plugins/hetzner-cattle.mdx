---
title: Hetzner Cattle
description: Ephemeral Hetzner VMs via the cattle plugin.
---

Cattle are on-demand, ephemeral OpenClaw agent VMs on Hetzner Cloud. The lifecycle is
simple: spawn, run a task, and destroy. This is separate from “pet” hosts, which are
long-running fleet servers.

<Callout type="warning" title="Experimental">
Cattle is optional and not the common path yet. Expect workflows and flags to change.
</Callout>

## Install the plugin

Install the cattle CLI plugin before running `clawlets cattle *` commands:

```bash
clawlets plugin add cattle
```

(Default package: `@clawlets/plugin-cattle`.)

## Principles

These constraints keep cattle simple and predictable:

- Hetzner-only.
- Tailnet-first: no public SSH by default.
- TTL everywhere: every cattle instance has an expiry.
- No secrets in Nix store.
- No provider secrets in Hetzner `user_data`.

## Config

Enable cattle in `fleet/clawlets.json` and set the Hetzner image and defaults:

```json
{
  "schemaVersion": 15,
  "cattle": {
    "enabled": true,
    "hetzner": {
      "image": "<image-id-or-name>",
      "serverType": "cx22",
      "location": "nbg1",
      "maxInstances": 10,
      "defaultTtl": "2h",
      "labels": { "managed-by": "clawlets" }
    },
    "defaults": { "autoShutdown": true, "callbackUrl": "" }
  }
}
```

Notes
- `cattle.hetzner.image` must point at a NixOS cattle image (see `clawlets-cattle-image`).
- Labels must be safe: ascii alnum + `._-`, max 63 chars, start/end alnum.

## Prereqs (operator)

Run these on the pet host (or over SSH to it). Cattle commands talk to the
orchestrator through a local Unix socket.

- Run these commands on the **Pet host** (or over SSH to it).
  - `clawlets cattle *` talks to `clf-orchestrator` via Unix socket (`/run/clf/orchestrator.sock`).
- `clf-orchestrator` deployed + running:
  - `systemctl status clf-orchestrator`
  - `systemctl status clf-orchestrator.socket`
- Socket access:
  - operator user in group `clf-bots` (or run as root).
- Tailscale installed + authenticated on the Pet host (used for SSH/logs): `tailscale status`

## Prereqs (project repo)

The project repo must include a cattle image and the secrets needed for tailnet join
and provider access.

- Cattle image uploaded to Hetzner as a custom image.
- Host secrets include:
  - `tailscale_auth_key` (for cattle VM to join tailnet)
  - provider keys for the chosen model(s) (wired via `fleet.secretEnv`)

Build + upload (Linux/CI recommended)

```bash
nix build -L .#clawlets-cattle-image
```

```bash
export HCLOUD_TOKEN=...
hcloud-upload-image upload --image-path ./result --architecture x86 --location nbg1 --labels managed-by=clawlets,role=cattle-image
```

Then set `fleet/clawlets.json`:

- `cattle.enabled=true`
- `cattle.hetzner.image="<image-id-or-name>"`

## Commands

These are the primary cattle commands you will use:

```bash
clawlets cattle persona add --name rex
clawlets cattle persona list

clawlets cattle spawn --persona rex --task-file ./task.json --ttl 2h
clawlets cattle spawn --persona rex --task-file ./task.json --ttl 2h --with-github-token
clawlets cattle spawn --persona rex --task-file ./task.json --ttl 2h --dry-run
clawlets cattle list
clawlets cattle logs <name-or-id> --follow
clawlets cattle ssh <name-or-id>
clawlets cattle destroy <name-or-id>
clawlets cattle reap --dry-run
```

Notes
- `clawlets cattle spawn` enqueues a `cattle.spawn` job into `clf-orchestrator` (it does not talk to Hetzner directly).
- Bots should use `clf jobs ...` directly; see [Orchestrator](/concepts/orchestrator).

## Task format

Tasks are small JSON payloads. Treat them as non-secret input.

`task.json` schema (v1):

```json
{
  "schemaVersion": 1,
  "taskId": "<id>",
  "type": "openclaw.gateway.agent",
  "message": "<prompt>"
}
```

Treat `task.json` as non-secret input. Secrets come from sops-managed files in `secrets/` and are injected at runtime.

## Persona registry

Personas are stored in the repo and injected into the VM at spawn time.

Project repo structure:

```
cattle/personas/
  rex/
    SOUL.md
    config.json
    skills/
    memory/
```

`clawlets cattle spawn --persona <name>` loads:

- `cattle/personas/<name>/SOUL.md`
- `cattle/personas/<name>/config.json` (`schemaVersion: 1`, `model.primary` optional)

Injected into the VM:

- `/var/lib/clawlets/cattle/persona/SOUL.md`
- `/var/lib/clawlets/cattle/persona/config.json`

## Access model (recommended)

- Cattle uses Tailscale for SSH/logging (tailnet-only).
- `clawlets cattle ssh` resolves the Tailscale IP via `tailscale ip -4 <hostname>`.

## Local state

- Local DB: `.clawlets/cattle/state.sqlite`
- Source of truth for lifecycle: Hetzner labels (`managed-by=clawlets,cattle=true`)

## Failure modes / debug

Most failures are configuration or tailnet related. Use the following as a quick
reference before diving into logs.

Common errors
- `cloud-init user_data too large`: reduce persona/task payload (cloud-init user_data is size-limited).
- `missing secretEnv mapping for <ENV_VAR>`: set `fleet.secretEnv.<ENV_VAR>` or per-bot override.
- `tailscale ip returned empty output`: the VM didn’t join tailnet (check `tailscale_auth_key`).

Debug commands
- list: `clawlets cattle list`
- logs: `clawlets cattle logs <id-or-name> --follow`
- ssh: `clawlets cattle ssh <id-or-name>`
- reap: `clawlets cattle reap --dry-run`
