---
title: Troubleshooting
description: Known errors and fixes.
---

These are common operator issues during bootstrap and day‑2 ops. Most fixes are
CLI‑driven so the host stays consistent with the project repo.

## `ssh-keygen` / “REMOTE HOST IDENTIFICATION HAS CHANGED”

After reinstall, host keys change. Remove the old key from `known_hosts` and try again.

```bash
ssh-keygen -R <ipv4>
ssh-keygen -R "[<ipv4>]:22" || true
```

`clawlets bootstrap` also clears known_hosts entries.

## Provisioning troubleshooting

If OpenTofu is failing inside the CLI, run it directly against the generated plan:
Run OpenTofu via nix directly (from your project repo, example plan):

```bash
nix run --impure nixpkgs#opentofu -- -chdir=.clawlets/infra/opentofu/<host> plan
```

## GitHub flake fetch 404

If your base flake repo is private, set `GITHUB_TOKEN` in your environment
(fine‑grained PAT, Contents read).

## `journalctl --since 5m` parse error

Use `--since "5 min ago"` or `clawlets server logs --since 5m` (CLI normalizes `5m`).

## `sudo: a terminal is required`

Use SSH TTY:

```bash
ssh -t <host> "sudo systemctl status clawdbot-melinda --no-pager"
```

CLI commands that may need sudo default to `--ssh-tty=true`.

## Gateway port already in use

This usually means a stale unit is still running or a port override collided. Check
listeners and restart the unit.
Check listeners:

```bash
ssh -t <host> "sudo ss -ltnp | grep ':187' || true"
```

Restart the unit:

```bash
clawlets server restart --target-host <host> --unit clawdbot-melinda.service
```

## CI deploy can’t reach host (tailnet)

- Verify `tailscale_auth_key` secret is valid and not expired.
- Ensure the host is in the tailnet and MagicDNS resolves.
- Confirm `fleet/clawlets.json` has `targetHost` set (e.g. `admin@<magicdns-name>`).

## CI deploy: SSH auth failed

- Ensure your public key is in `fleet.sshAuthorizedKeys` (project scope).
- If the host was reprovisioned, re‑add the key and redeploy.

## Cache miss / toplevel not found

- Confirm the manifest’s `toplevel` exists in the cache (Garnix).
- Re‑run the manifest workflow on `main` to republish.
- Ensure the host Nix settings include the substituter(s) used by the manifest.

## Self‑update: minisign verification failed

- Confirm `hosts.<host>.selfUpdate.publicKeys` includes the key used in CI.
- Ensure `.minisig` exists at `.../latest.json.minisig`.
- Re‑run the manifest workflow to republish signatures.

## `clf` socket: permission denied / ENOENT

- Verify socket exists:
  - `ls -la /run/clf/orchestrator.sock`
  - `systemctl status clf-orchestrator.socket`
- Verify caller is allowed:
  - `id` includes group `clf-bots`
  - or run as root

## Cattle job stuck (queued/running)

Check orchestrator logs and inspect the job payload to see where it stopped.
- Orchestrator logs: `journalctl -u clf-orchestrator --since 30m --no-pager`
- Job inspect: `clf jobs show --job-id <jobId> --json`
- Common causes:
  - Hetzner API rate limits / quota
  - bad `cattle.hetzner.image`
  - cattle didn’t join tailnet (bad `tailscale_auth_key`)
