---
title: Runner Agent
description: Pair, start, and operate runner agents.
---

Runner agents execute jobs for a project and report metadata back to the control plane.

## Pairing

Create a runner token from the dashboard/admin surface, then start the runner:

```bash
clawlets runner start \
  --project <projectId> \
  --token <runner-token> \
  --control-plane-url <https://dashboard-host>
```

Optional flags:

- `--name <runner-name>`
- `--repoRoot <repo-path>`
- `--pollMs <interval>`
- `--leaseTtlMs <ttl>`
- `--heartbeatMs <ttl>`
- `--maxAttempts <n>`

## Heartbeats and capabilities

Runner sends:

- runner heartbeat (`/runner/heartbeat`)
- job lease heartbeat (`/runner/jobs/heartbeat`)

If heartbeat goes stale, jobs become lease-eligible again after TTL expiry.

Runner heartbeat capabilities include:

- `supportsInfraApply`
- `supportsSealedInput`
- `sealedInputAlg`
- `sealedInputPubSpkiB64`
- `sealedInputKeyId`

## Secrets handling

Default secure path:

- Browser encrypts secret payload for the target runner and sends ciphertext only to control plane.
- Jobs are reserved first (`sealed_pending`) and become leasable only after ciphertext finalize.
- Runner decrypts sealed payload locally and executes command non-interactively.
- Placeholder jobs fail fast when sealed input is missing/invalid.

Control plane never stores plaintext secret values.

Operator walkthrough for this flow: [Deploy credentials](/dashboard/deploy-credentials).

## Metadata sync limits

`/runner/metadata/sync` enforces bounded payload sizes:

- `projectConfigs <= 500`
- `hosts <= 200`
- `gateways <= 500`
- `secretWiring <= 2000`
- per-host `secretWiring <= 500` (extra rows dropped)

Oversized payloads are rejected (`400`).

## Error taxonomy and stop/retry policy

Runner HTTP errors are classified as:

- `auth`: `401`/`403`
- `permanent`: non-`429` `4xx`
- `transient`: `429`, `5xx`, network errors, request timeouts
- `malformed`: invalid JSON response

Runner behavior:

- Lease loop: `auth`/`permanent` stop; `transient`/`malformed`/`unknown` retry with backoff.
- Job completion call: `auth`/`permanent` stop; `transient`/`malformed`/`unknown` continue.
- Heartbeat, metadata sync, and run-event append failures are logged and non-fatal.

## Filesystem boundary

Runner-local only:

- Git working tree
- `.clawlets/` runtime state
- SOPS keys/material
- SSH credentials

Control plane should not mount or require repo-root paths.

## Troubleshooting

- **Runner offline:** verify process is running and token is not revoked.
- **Jobs stuck queued:** check runner project id, token scope, and lease endpoints reachability.
- **Lease expired mid-run:** ensure heartbeat interval is below lease TTL.
- **No sealed-capable runner available:** upgrade runner and confirm heartbeat includes `supportsSealedInput`, `sealedInputPubSpkiB64`, and `sealedInputKeyId`.
- **Metadata sync rejected (`400`):** reduce payload array sizes to documented limits.
- **Repeated failures:** inspect run logs (`runs` + `runEvents`) and adjust command args/config.
