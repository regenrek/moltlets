---
title: Install
description: Prereqs and bootstrap setup.
---

This section covers the operator prerequisites and the initial bootstrap flow. The
assumption is local, self‑hosted operation: you run the dashboard and CLI from your
workstation, then bootstrap a host through the configured infrastructure provider.

## Install clawlets (CLI)

Install the CLI globally so you can run it from any project repo:

```bash
npm install -g clawlets
clawlets --help
```

Node >= 22 required.

## Project repo inputs

`clawlets project init` scaffolds the repo. These directories and files are the core
inputs for every deploy.

Created by `clawlets project init`:

- `fleet/clawlets.json` (canonical config: fleet + hosts)
- `flake.nix` / `flake.lock` (build graph)
- `secrets/` (committed; sops‑encrypted secrets + rules)
- `.clawlets/` (gitignored runtime: operator keys + extra‑files + infra state + images)
- `fleet/workspaces/` (AGENTS/SOUL/TOOLS/IDENTITY/USER/HEARTBEAT)

## Provider selection (first decision)

Choose `hosts.<host>.provisioning.provider` before filling provider-specific fields.
This is the Day 0 infra decision and should happen before gateway/OpenClaw setup.

```bash
clawlets host set --host <host> --provider hetzner
```

Current support:

- `hetzner` is fully supported for bootstrap and lockdown.
- `aws` is supported via Phase 2 image/AMI workflow (`bootstrap --mode image`).

## Hetzner specifics (current production path)

Clawlets assumes Hetzner’s VM environment. These defaults are wired into the
provisioning flow and should not be changed unless you control the base image.

Clawlets assumes Hetzner’s VM environment and networking defaults:

- legacy BIOS (SeaBIOS) → GRUB (i386‑pc) + GPT `EF02` BIOS boot partition
- DHCP via `systemd-networkd` (Hetzner hands out `/32` + gateway `172.31.1.1`)
- initrd includes virtio modules

## Deterministic dev env (recommended)

Use a deterministic dev shell so tooling versions match CI and the template:

```bash
devenv shell
```

## Tooling bundle (optional)

Enable extra tools:

```nix
services.openclawFleet.tools.enable = true;
```

## Image upload helper (optional)

If you plan to build and upload custom images, install the helper:

```bash
go install github.com/apricote/hcloud-upload-image@latest
```

## 0) Prefill checklist

Before you bootstrap, make sure the required fields are present. The dashboard can
guide you through these, but the checklist is useful when scripting or reviewing.

Before you bootstrap, make sure the basics are set:

- `fleet/clawlets.json`
  - `fleet.secretEnv` / `fleet.secretFiles`
  - `fleet.sshAuthorizedKeys` / `fleet.sshKnownHosts`
  - `hosts.<host>.gatewaysOrder`
  - `hosts.<host>.gateways.<gatewayId>.profile` (skills, github, secretEnv/secretFiles)
  - `hosts.<host>.gateways.<gatewayId>.openclaw` (raw OpenClaw config)
  - `hosts.<host>.diskDevice`
  - `hosts.<host>.provisioning.provider`
  - `hosts.<host>.provisioning.adminCidr`
  - `fleet.sshAuthorizedKeys` (at least one key; used for provisioning + admin access)
  - `hosts.<host>.sshExposure.mode = "bootstrap"`
  - `hosts.<host>.tailnet.mode` (`tailscale` or `none`)
  - provider subtree
    - Hetzner: `hosts.<host>.hetzner.serverType`, `hosts.<host>.hetzner.location`, optional `hosts.<host>.hetzner.image`
    - Hetzner optional hardening: set `hosts.<host>.hetzner.allowTailscaleUdpIngress = false` to disable inbound UDP/41641 (relay-only mode)
    - AWS: `hosts.<host>.aws.region`, `hosts.<host>.aws.instanceType`, `hosts.<host>.aws.amiId`, plus VPC/subnet/default-VPC fields
    - AWS optional hardening: set `hosts.<host>.aws.allowTailscaleUdpIngress = false` to disable inbound UDP/41641 (relay-only mode)
- `secrets/`
  - `secrets/.sops.yaml` (generated by `clawlets secrets init`)
  - `secrets/hosts/<host>/admin_password_hash.yaml` (required)
  - `secrets/hosts/<host>/tailscale_auth_key.yaml` (required when tailnet.mode=tailscale)
  - per‑gateway channel tokens referenced via `hosts.<host>.gateways.<gatewayId>.profile.secretEnv`
- `.clawlets/`
  - `env` (deploy creds; created by `clawlets env init`)
  - `keys/operators/<you>.agekey` (operator key; created by `clawlets secrets init`)

## Disk device

The disk device is required for `disko` to format and mount the system drive.

Set in `fleet/clawlets.json` or via CLI:

```bash
clawlets host set --host <host> --disk-device /dev/sda
```

## Deploy credentials (`.clawlets/env`)

Deployment credentials are stored locally in a gitignored file:

Create the env file (gitignored):

```bash
clawlets env init
```

Edit `.clawlets/env`:

- `HCLOUD_TOKEN` (required for `provisioning.provider=hetzner`)
- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY` (required for `provisioning.provider=aws` unless ambient AWS auth is configured)
- `AWS_SESSION_TOKEN` (optional; temporary credentials)
- `GITHUB_TOKEN` (only if your base flake repo is private)
- `NIX_BIN` (optional override)
- `SOPS_AGE_KEY_FILE` (optional override)

<Callout type="info" title="Lifecycle split: Day 0 infra vs Day X OpenClaw">
  Day 0 covers provider bootstrap (`bootstrap`, `infra`, `lockdown`) and host access.
  OpenClaw gateway config and policies are Day X operations and can be evolved after
  bootstrap is stable.
</Callout>

## Admin password (required)

Generate a yescrypt hash locally and store it in sops:

<Callout type="warning" title="Required before bootstrap">
  `admin_password_hash` must be present in `secrets/hosts/<host>/admin_password_hash.yaml`
  before `clawlets bootstrap` runs, or the install will fail.
</Callout>

Generate yescrypt hash locally:

```bash
nix shell nixpkgs#mkpasswd -c mkpasswd -m yescrypt
```

Store in sops:

```bash
SOPS_AGE_KEY_FILE=.clawlets/keys/operators/<you>.agekey \
  sops edit secrets/hosts/<host>/admin_password_hash.yaml
```

Set:

- `admin_password_hash: '$y$j9T$...'`

## 1) Bootstrap (nixos‑anywhere)

The bootstrap step provisions the host and installs NixOS from the project repo:

```bash
clawlets secrets init
clawlets doctor --scope bootstrap
clawlets bootstrap
```

## 1b) Image‑based bootstrap (optional)

If you prefer a custom image workflow, build and upload an image first:

```bash
# Build raw image artifact
clawlets image build --host <host>

# Hetzner upload path
clawlets image upload --host <host> --image-url https://<bucket>/<image>.raw --compression bz2
clawlets host set --host <host> --hetzner-image <image_id_or_name>

# AWS upload/import path
clawlets image aws publish --host <host> --image-path .clawlets/images/<host>/<image>.raw --bucket <s3-bucket>
clawlets host set --host <host> --aws-ami-id <ami-id>

# Bootstrap from image
clawlets bootstrap --mode image
```

## 2) Publish + apply updates

Once the host is up, publish a signed manifest and apply it:

```bash
clawlets release manifest build --host <host> --channel prod --system x86_64-linux --release-id <releaseId> --out deploy/<host>/prod/<releaseId>.json
clawlets release manifest sign --in deploy/<host>/prod/<releaseId>.json
clawlets release pointer write --release-id <releaseId> --out deploy/<host>/prod/latest.json
clawlets release manifest sign --in deploy/<host>/prod/latest.json
clawlets server update apply --host <host>
```

More deploy/update options: [Deploy](/operations/deploy).
