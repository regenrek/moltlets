---
title: Operations
description: Day‑2 operations and maintenance.
---

This page collects the most common day‑2 workflows: updating config, rotating secrets,
adding gateways, and checking host health.

## Update OpenClaw config (routing/channels)

Clawlets does not own routing. Update routing via OpenClaw config and channels via
first-class channel config, then publish and apply an update so the host picks up the
new desired state:

- edit `fleet/clawlets.json` → `hosts.<host>.gateways.<gatewayId>.openclaw` (routing/tools/etc)
- edit `fleet/clawlets.json` → `hosts.<host>.gateways.<gatewayId>.channels` (typed channels)

Then publish + apply updates (pinned):

```bash
clawlets release manifest build --host <host> --channel prod --release-id <releaseId> --out deploy/<host>/prod/<releaseId>.json
clawlets release manifest sign --in deploy/<host>/prod/<releaseId>.json
clawlets server update apply --host <host>
```

`--rev HEAD` resolves to the full SHA locally before the deploy.

## Rotate tokens/secrets

Token rotation follows the same flow every time: update the encrypted file, sync it to
the host, verify, then apply an update.

1) Edit files under `secrets/hosts/<host>/` (example: `discord_token_maren.yaml`)
2) Re‑encrypt (or use `clawlets secrets init` to regenerate)
3) `clawlets secrets sync`
4) `clawlets secrets verify`
5) Apply updates:

```bash
clawlets server update apply --host <host>
```

## Add a gateway

Adding a gateway means adding its ID, wiring secrets, and pushing a new deploy. The
dashboard can do most of this for you; the CLI steps are here for repeatability.

1) Add gateway id:

```bash
clawlets gateway add --host <host> --gateway <gatewayId>
```

2) Add secret + config:

- `hosts.<host>.gateways.<gatewayId>.profile.secretEnv.DISCORD_BOT_TOKEN = "discord_token_<gatewayId>"`
- channel config: `hosts.<host>.gateways.<gatewayId>.channels.discord = { enabled: true, token: "${DISCORD_BOT_TOKEN}" }`

Then:

```bash
clawlets secrets sync
clawlets server update apply --host <host>
```

## Add/enable a skill

Skills are controlled by an allowlist and may require per-gateway secrets. Once you wire
the secret and allowlist, deploy the updated config.

1) If bundled: add id to `fleet/bundled-skills.json`
2) Allow per‑gateway (example):

```bash
clawlets config set --path hosts.<host>.gateways.maren.skills.allowBundled --value-json '["github","brave-search"]'
```
3) If it needs secrets: add `secrets/hosts/<host>/<secret>.yaml` and reference in `hosts.<host>.gateways.<gatewayId>.skills.entries."<skill>".apiKeySecret`
4) Sync + deploy:

```bash
clawlets secrets sync
clawlets server update apply --host <host>
```

## Verify host health

These commands give a quick signal of service health, logs, and audit status:
```bash
clawlets server status --target-host admin@<ipv4>
clawlets server logs --target-host admin@<ipv4> --unit openclaw-maren.service --follow
clawlets server audit --target-host admin@<ipv4>
```

Justfile helpers:

```bash
just server-units admin@<ipv4>
just server-logs admin@<ipv4> "--unit openclaw-maren.service --follow"
```

## Codex CLI (headless)

If you enable Codex on a gateway, the device login is a one-time step per gateway user.

One‑time device auth per gateway:

```bash
sudo -u gateway-maren env HOME=/srv/openclaw/maren codex login --device-auth
sudo -u gateway-gunnar env HOME=/srv/openclaw/gunnar codex login --device-auth
```

## Plugins (experimental)

External CLF/cattle plugins are experimental and not part of core operations support.
See [Plugins overview](/plugins).

## Tailscale

Basic tailnet health checks:
```bash
tailscale status
tailscale ip -4
```

## GitHub App token refresher (example)

Token refreshers run as systemd units; check status when GitHub auth fails.

```bash
systemctl status openclaw-gh-token-maren
systemctl status openclaw-gh-token-maren.timer
```

## GitHub inventory sync (optional)

If enabled, the host periodically writes GitHub issues and PRs into the gateway workspace.
If enabled (`services.openclawFleet.githubSync.enable = true`), each gateway writes:

- `/srv/openclaw/<gatewayId>/workspace/memory/github/prs.md`
- `/srv/openclaw/<gatewayId>/workspace/memory/github/issues.md`

Ops helpers:

```bash
clawlets server github-sync status --target-host admin@<ipv4>
clawlets server github-sync run --target-host admin@<ipv4> --gateway maren
clawlets server github-sync show --target-host admin@<ipv4> --gateway maren --kind prs --lines 80
```

## Ops snapshots (optional)

Snapshots are optional and designed for quick ops state inspection and backups.
If enabled (`services.openclawFleet.opsSnapshot.enable = true`), the host writes JSON snapshots to:

- `/var/lib/clawlets/ops/snapshots/latest.json`
- `/var/lib/clawlets/ops/snapshots/<timestamp>-<host>.json`

Retention:

- `services.openclawFleet.opsSnapshot.keepDays` (default: 30)
- `services.openclawFleet.opsSnapshot.keepLast` (default: 200)

Backup:

- When restic is enabled and `backups.restic.paths` is empty, ops snapshots are included automatically.

Run now:

```bash
sudo systemctl start clawlets-ops-snapshot.service
```

## Backups (restic)

Restic is opt-in. Enable it in the fleet config, wire its secrets, then deploy.
Enable via CLI:

```bash
clawlets fleet set --restic-enable true --restic-repository "s3:s3.amazonaws.com/<bucket>/openclaw"
```

Add secrets under `secrets/hosts/openclaw-fleet-host/` (example: `restic_password.yaml`), sync, then deploy.

Restore (example, run as root on the host):

```bash
restic snapshots
restic restore latest --target / --include /srv/openclaw
```
