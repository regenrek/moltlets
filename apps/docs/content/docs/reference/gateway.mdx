---
title: Gateway
description: Gateway behavior and ports.
---

Clawlets runs **one OpenClaw Gateway per gateway instance** to keep state and credentials isolated.
This gives each gateway its own user, workspace, and network ports.

## Why

If a gateway user is compromised, it should not be able to read or write another gateway's
state or workspace. Isolation also reduces the blast radius for credentials, sessions,
tools, and config.

## Prereqs

- Access to `fleet/clawlets.json`.
- Clawlets CLI installed (for validation).

## Gateway instances vs agents

- **Gateway instance**: one OpenClaw gateway process with its own state dir, ports, and OS user.
- **Agent/persona**: an entry in `agents.list[]` that runs **inside** a gateway instance.

Use agents when you want multiple personas sharing the same gateway process. Use multiple gateways when you need hard
isolation per persona.

## Steps

<Steps>
  <Step>Define gateway ids in <code>hosts.&lt;host&gt;.gatewaysOrder</code> and <code>hosts.&lt;host&gt;.gateways</code>.</Step>
  <Step>Override a base port per gateway if needed via <code>hosts.&lt;host&gt;.gateways.&lt;gatewayId&gt;.profile.gatewayPort</code>.</Step>
  <Step>Validate the config: <code>clawlets config validate --host &lt;host&gt;</code>.</Step>
</Steps>

## Gateway architecture

The dashboard stores the chosen shape in `fleet.gatewayArchitecture` (`multi|single`). This is a UI preference only; it does not rewrite or migrate your config.

### Option A — multiple gateways (`multi`)

Each gateway is its own gateway instance.

```jsonc
{
  "hosts": {
    "business": {
      "gatewaysOrder": ["main", "rescue"],
      "gateways": {
        "main": {},
        "rescue": {}
      }
    }
  }
}
```

### Option B — one gateway, multiple agents (`single`)

One gateway process, multiple agents via `agents.list[]`.

```jsonc
{
  "hosts": {
    "business": {
      "gatewaysOrder": ["main"],
      "gateways": {
        "main": {
          "agents": {
            "list": [
              { "id": "primary", "default": true, "name": "Primary" },
              { "id": "support", "name": "Support" }
            ]
          }
        }
      }
    }
  }
}
```

## Isolation checklist (per gateway)

For each gateway `maren`:

- system user: `gateway-maren`
- state dir: `/srv/openclaw/maren` (`OPENCLAW_STATE_DIR`)
- config path: `/run/secrets/rendered/openclaw-maren.json` (`OPENCLAW_CONFIG_PATH`)
- workspace: `/srv/openclaw/maren/workspace` (`agents.defaults.workspace`)
- base port: `gateway.port` (derived ports must not collide)
- gateway mode: `gateway.mode = "local"`
- auth: `gateway.auth` is always enabled (even on loopback)

## Ports

Default port base is `18789`, stride `120`.

Reason: openclaw uses derived ports (bridge/browser/canvas). Spacing avoids collisions across gateways.

Override per gateway:

```bash
clawlets config set --path hosts.<host>.gateways.maren.profile.gatewayPort --value 18809
```

## Gateway auth token

Loopback gateways should not run unauthenticated because any local process could call
`config.apply`. Clawlets-template enforces token auth and wires the token per gateway.

Clawlets-template enforces:

- `gateway.auth.mode = "token"`
- `gateway.auth.token = "${OPENCLAW_GATEWAY_TOKEN}"`

Token source (per gateway):

- `/srv/openclaw/<gatewayId>/credentials/gateway.env`

Generated automatically by:

- `openclaw-gateway-token-<gatewayId>.service` (oneshot)

## Verify

- `clawlets config validate --host <host>` returns `ok`.
- Each gateway resolves to a unique base port (no overlaps).
- `gateway.auth.mode` is `token` in the rendered OpenClaw config.

## Troubleshooting

- **Port collisions**: ensure `hosts.<host>.gatewaysOrder` is stable and `gatewayPort` overrides do not overlap.
- **Missing auth token**: verify the gateway credential service ran and the `gateway.env` file exists.

## Links

- [Gateways and personas](/configuration/gateways-and-personas)
- [Config schema](/configuration/config)
