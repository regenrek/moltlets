---
title: SOPS age key
description: Host-scoped SOPS operator key behavior and recovery.
---

Setup does not ask you to enter <code>SOPS_AGE_KEY_FILE</code>. The runner manages this
internally with a host-scoped operator key path:

`<runtimeDir>/keys/operators/hosts/<host>/<operator>.agekey`

The key is ensured on setup entry, then checked again immediately before setup deploy/apply.
This avoids project-wide shared key path reuse across hosts.

## Prereqs

- Setup route open for target host: <code>/$projectSlug/hosts/$host/setup</code>.
- Runner online for the project.

## How setup uses it

<Steps>
  <Step>
    Enter setup for host <code>&lt;host&gt;</code>.
  </Step>
  <Step>
    Runner ensures host-scoped operator key exists.
  </Step>
  <Step>
    During install, setup injects <code>SOPS_AGE_KEY_FILE</code> with that host-scoped path for the action.
  </Step>
</Steps>

## Manual recovery (CLI)

```bash
clawlets env generate-age-key --host <host> --json
```

This generates/reuses the host-scoped key. In host-scoped mode, it does not rewrite a
project-wide <code>SOPS_AGE_KEY_FILE</code> pointer.

## Verify

- Setup UI does not show a SOPS field.
- Deploy step proceeds without manual SOPS path input.
- Optional runner check:

```bash
clawlets env detect-age-key --host <host> --json
```

## Troubleshooting

### “No valid age key found”

- Run `clawlets env generate-age-key --host <host> --json`.
- Confirm runner has write access to `<runtimeDir>/keys/operators/hosts/<host>/`.

### “existing key file invalid”

- Existing host-scoped key file exists but is invalid.
- Fix or remove the file, then rerun host-scoped generate command.

### Setup deploy still fails on SOPS preparation

- Keep runner online and retry deploy.
- If failures continue, run host-scoped generate command manually and inspect run logs.
