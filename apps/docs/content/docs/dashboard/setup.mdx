---
title: Setup
description: Guided first deploy checklist.
---

Setup is the host onboarding flow for first install. It keeps non-secret edits as draft state,
then executes one sealed `setup_apply` job before bootstrap.

Setup gating is host-scoped and GitHub-token based. `SOPS_AGE_KEY_FILE` is not shown in setup UI.
The runner prepares a host-scoped operator key path internally when setup opens, and re-checks it
again right before deploy.

<Callout type="info" title="Runner setup happens before host setup">
  Project creation and runner setup are completed first. This setup flow starts at host onboarding.
  Keep the runner online for config probes, sealed-save actions, and final apply/deploy jobs.
  See [Runner Agent](/operations/runner-agent).
</Callout>

## Where to start

Open:

- Setup: `http://localhost:3000/<projectSlug>/setup`
- Deploy (global chooser): `http://localhost:3000/<projectSlug>/~/deploy`
- Deploy (host): `http://localhost:3000/<projectSlug>/hosts/<host>/deploy`

## Flow

<Steps>
  <Step>
    <strong>Hetzner setup</strong>
    <br />
    Set an active <code>HCLOUD_TOKEN</code> and confirm Hetzner host defaults:
    <code>serverType</code>, <code>location</code>, optional <code>image</code>.
  </Step>
  <Step>
    <strong>Server Access</strong>
    <br />
    Add at least one SSH public key to{" "}
    <code>fleet.sshAuthorizedKeys</code>. You can add keys inline in Setup or from [SSH keys](/dashboard/ssh-keys).
    Admin CIDR is auto-detected and can be overridden in <strong>Advanced options</strong>.
  </Step>
  <Step>
    <strong>Tailscale lockdown</strong>
    <br />
    Enable <code>Use tailscale + lockdown</code> for safer SSH path. Setup auto-enables
    <code>allowTailscaleUdpIngress</code> when this toggle is enabled, and still allows
    manual override for relay-only mode.
  </Step>
  <Step>
    <strong>Install Server</strong>
    <br />
    Setup requires <code>GITHUB_TOKEN</code> to proceed. Deploy runs one sealed <code>setup_apply</code>
    job (config + host-scoped deploy creds pointer + bootstrap secrets), then runs bootstrap.
  </Step>
  <Step>
    <strong>Secure and Verify</strong>
    <br />
    Run the post-bootstrap checklist (tailnet switch, SSH lockdown) and confirm the host is stable.
  </Step>
</Steps>

## What setup stores in Convex

Setup uses Convex as resumable draft state for this host:

Non-secret draft fields:

- `nonSecretDraft.infrastructure.serverType`
- `nonSecretDraft.infrastructure.image`
- `nonSecretDraft.infrastructure.location`
- `nonSecretDraft.infrastructure.allowTailscaleUdpIngress`
- `nonSecretDraft.connection.adminCidr`
- `nonSecretDraft.connection.sshExposureMode`
- `nonSecretDraft.connection.sshKeyCount`
- `nonSecretDraft.connection.sshAuthorizedKeys`

`allowTailscaleUdpIngress` is controlled in Setup under the Tailscale lockdown step.

Sealed secret section metadata:

- `alg`, `keyId`, `targetRunnerId`, `aad`, `sealedInputB64`, `updatedAt`, `expiresAt`

Read-side status projection:

- `sealedSecretDrafts.deployCreds.status`
- `sealedSecretDrafts.bootstrapSecrets.status`

Setup readiness checks do not require manual SOPS key path input. The deploy step writes
`deployCreds` with a host-scoped `SOPS_AGE_KEY_FILE` automatically.

Convex does not store plaintext values for deploy credentials or bootstrap secrets.

## Verify

You are “done” when:

- Deploy shows an initial install that completed successfully for the host.
- The post-bootstrap checklist is green (or you have consciously accepted the remaining risk).
- Follow-up Deploy runs apply changes cleanly.

After this, continue with OpenClaw app-layer setup:

- [OpenClaw setup](/dashboard/openclaw-setup)
- [How Clawlets works](/dashboard/how-clawlets-works)

## Troubleshooting

### Setup says “project setup in progress”

The project init run has not finished yet. Open Runs and wait for it to succeed:

- `/<projectSlug>/runs`

### Secrets step won’t complete

Setup requires saving the sealed secret draft for the selected host.
Re-open the Secrets step, replace missing values, and click <strong>Save & Continue</strong>.

### Token already exists locally but setup shows missing

Setup step status is draft-based. If the setup draft for this host does not have the
sealed deploy-credentials section yet, the step shows `HCLOUD_TOKEN` as missing.
Save the token in setup once to mark the draft section as set.

### Deploy says credentials missing

Open Setup → Hetzner setup and make sure <code>GITHUB_TOKEN</code> is set.
Setup deploy readiness is GitHub-token based.

Recommended path:

- Save `HCLOUD_TOKEN` (Hetzner): [Hetzner token setup](/dashboard/hetzner-token)
- Save `GITHUB_TOKEN`: [GitHub token setup](/dashboard/github-token)
- See provider docs: [Hetzner](/providers/hetzner)
